
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../linear/">
      
      
        <link rel="next" href="../lstm/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>LSTMCell (torch.nn.LSTMCell) - moduleprofiler</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lstmcell-torchnnlstmcell" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="moduleprofiler" class="md-header__button md-logo" aria-label="moduleprofiler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            moduleprofiler
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LSTMCell (torch.nn.LSTMCell)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../documentation/" class="md-tabs__link">
        
  
    
  
  Documentation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorial/" class="md-tabs__link">
        
  
    
  
  Tutorial

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../reference/" class="md-tabs__link">
          
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/eagomez2/moduleprofiler/releases" class="md-tabs__link">
        
  
    
  
  Changelog

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../license/" class="md-tabs__link">
        
  
    
  
  License

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="moduleprofiler" class="md-nav__button md-logo" aria-label="moduleprofiler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    moduleprofiler
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conv1d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conv1d (torch.nn.Conv1d)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conv2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conv2d (torch.nn.Conv2d)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../convtranspose1d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ConvTranspose1d (torch.nn.ConvTranspose1d)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../convtranspose2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ConvTranspose2d (torch.nn.ConvTranspose2d)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grucell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GRUCell (torch.nn.GRUCell)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gru/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GRU (torch.nn.GRU)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../layernorm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LayerNorm (torch.nn.LayerNorm)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear (torch.nn.Linear)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    LSTMCell (torch.nn.LSTMCell)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    LSTMCell (torch.nn.LSTMCell)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#complexity" class="md-nav__link">
    <span class="md-ellipsis">
      Complexity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complexity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-gate" class="md-nav__link">
    <span class="md-ellipsis">
      Input gate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forget-and-output-gates" class="md-nav__link">
    <span class="md-ellipsis">
      Forget and output gates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cell-gate" class="md-nav__link">
    <span class="md-ellipsis">
      Cell gate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cprime" class="md-nav__link">
    <span class="md-ellipsis">
      \(c\prime\)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hprime" class="md-nav__link">
    <span class="md-ellipsis">
      \(h\prime\)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#total-complexity" class="md-nav__link">
    <span class="md-ellipsis">
      Total complexity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lstm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LSTM (torch.nn.LSTM)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../relu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReLU (torch.nn.ReLU)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sigmoid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sigmoid (torch.nn.Sigmoid)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../softmax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Softmax (torch.nn.Softmax)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tanh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tanh (torch.nn.Tanh)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/eagomez2/moduleprofiler/releases" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="lstmcell-torchnnlstmcell">LSTMCell (<code>torch.nn.LSTMCell</code>)</h1>
<p>A <code>torch.nn.LSTMCell</code> correspond to a single cell of a Long Short-Term Memory Layer (<code>torch.nn.LSTM</code>). A <code>torch.nn.LSTMCell</code> takes in an <strong>input</strong> <span class="arithmatex">\(x\)</span>, a <strong>hidden state</strong> <span class="arithmatex">\(h\)</span> and a <strong>cell state</strong> <span class="arithmatex">\(c\)</span> . Internally, it has an <strong>input gate</strong> <span class="arithmatex">\(i\)</span>, a <strong>forget gate</strong> <span class="arithmatex">\(f\)</span>, a <strong>cell gate</strong> <span class="arithmatex">\(g\)</span> and an <strong>output gate</strong> <span class="arithmatex">\(o\)</span> that help to propagate information between sequence steps. These are combined to generate the <code>torch.nn.LSTMCell</code> outputs. The relationship between these tensors is defined as</p>
<div class="arithmatex">\[
\begin{align}
    i &amp;= \sigma\left(W_{ii}x+b_{ii}+W_{hi}h+b_{hi}\right) \\
    f &amp;= \sigma\left(W_{if}x+b_{if}+W_{hf}h+b_{hf}\right) \\
    g &amp;= \text{tanh}\left(W_{ig}x+b_{ig}+W_{hg}h+b_{hg}\right) \\
    o &amp;= \sigma\left(W_{io}x+b_{io}+W_{ho}h+b_{ho}\right) \\
    c\prime &amp;= f\odot c+i\odot g \\
    h\prime &amp;= o \odot\text{tanh}\left(c\prime\right)
\end{align}
\]</div>
<p>Where</p>
<ul>
<li><span class="arithmatex">\(x\)</span> is the input tensor of size <span class="arithmatex">\(\left(N, H_{in}\right)\)</span> or <span class="arithmatex">\(\left(H_{in}\right)\)</span>.</li>
<li><span class="arithmatex">\(h\)</span> is the hidden state tensor of size <span class="arithmatex">\(\left(N, H_{out}\right)\)</span> or <span class="arithmatex">\(\left(H_{out}\right)\)</span>.</li>
<li><span class="arithmatex">\(c\)</span> is the cell state tensor of size <span class="arithmatex">\(\left(N, H_{out}\right)\)</span> or <span class="arithmatex">\(\left(H_{out}\right)\)</span>.</li>
<li><span class="arithmatex">\(W_{ii}\)</span>, <span class="arithmatex">\(W_{if}\)</span>, <span class="arithmatex">\(W_{ig}\)</span> and <span class="arithmatex">\(W_{io}\)</span> are weight tensors of size <span class="arithmatex">\(\left(H_{out}, H_{in}\right)\)</span>. </li>
<li><span class="arithmatex">\(W_{hi}\)</span>, <span class="arithmatex">\(W_{hf}\)</span>, <span class="arithmatex">\(W_{hg}\)</span> and <span class="arithmatex">\(W_{ho}\)</span> are weight tensors of size <span class="arithmatex">\(\left(H_{out}, H_{out}\right)\)</span>.</li>
<li><span class="arithmatex">\(\sigma\)</span> is the sigmoid function and can be defined as <span class="arithmatex">\(\sigma\left(x\right)=\frac{1}{1+e^{-x}}\)</span>.</li>
<li><span class="arithmatex">\(\text{tanh}\)</span> is the hyperbolic tangent function and can be defined as <span class="arithmatex">\(\text{tanh}\left(x\right)=\frac{e^x-e^{-x}}{e^x+e^{-x}}\)</span>.</li>
<li><span class="arithmatex">\(\odot\)</span> is the <a href="https://en.wikipedia.org/wiki/Hadamard_product_(matrices)" target="_blank">Hadamard product</a> or element-wise product.</li>
<li><span class="arithmatex">\(b_{ii}\)</span>, <span class="arithmatex">\(b_{hi}\)</span>, <span class="arithmatex">\(b_{if}\)</span>, <span class="arithmatex">\(b_{hf}\)</span>, <span class="arithmatex">\(b_{ig}\)</span>, <span class="arithmatex">\(b_{hg}\)</span>, <span class="arithmatex">\(b_{io}\)</span> and <span class="arithmatex">\(b_{ho}\)</span> are bias tensors of size <span class="arithmatex">\(\left(H_{out}\right)\)</span>.</li>
</ul>
<h2 id="complexity">Complexity</h2>
<p>In order to compute the complexity of a single <code>torch.nn.LSTMCell</code>, it is necessary to estimate the number of operations of all six aforementioned equations. For the sake of simplicity, for operations involving sigmoid and hyperbolic tangent, the aforementioned equations will be used and exponentials will be counted as a single operation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>During the following operations, some tensors have to be transposed in order to have compatible dimensions to perform matrix multiplication, even thought this is not explicitly mentioned in <a href="https://pytorch.org/docs/stable/generated/torch.nn.LSTMCell.html", target="_blank">PyTorch <code>torch.nn.LSTMCell’s</code> documentation</a>. Additionally, some weight tensors are stacked. For instance, <span class="arithmatex">\(W_{ii}\)</span>, <span class="arithmatex">\(W_{if}\)</span> <span class="arithmatex">\(W_{ig}\)</span> and <span class="arithmatex">\(W_{io}\)</span> are implemented as a single tensor of size <span class="arithmatex">\(\left(4\times H_{out},H_{in} \right)\)</span>, and <span class="arithmatex">\(W_{hi}\)</span>, <span class="arithmatex">\(W_{hf}\)</span>, <span class="arithmatex">\(W_{hg}\)</span> and <span class="arithmatex">\(W_{ho}\)</span> are implemented as a single tensor of size <span class="arithmatex">\(\left(4\times H_{out},H_{out} \right)\)</span>, possibly due to efficiency reasons.</p>
</div>
<h3 id="input-gate">Input gate</h3>
<p>The tensor sizes involved in the operations performed to calculate the input gate <span class="arithmatex">\(i\)</span> are</p>
<div class="arithmatex">\[
\begin{align}
    i = \sigma\Bigg(\underbrace{\left(H_{out}, H_{in}\right) \times \left(N, H_{in}\right)}_{W_{ii}x} + \underbrace{H_{out}}_{b_{ii}} + \underbrace{\left(H_{out}, H_{out}\right) \times \left(N, H_{out}\right)}_{W_{hi}h} + \underbrace{H_{out}}_{b_{hi}}\Bigg)
\end{align}
\]</div>
<p>In this case, <span class="arithmatex">\(x\)</span> (with shape <span class="arithmatex">\(\left(N, H_{in}\right)\)</span>) and <span class="arithmatex">\(h\)</span> (with shape <span class="arithmatex">\(\left(N, H_{out}\right)\)</span>) have to be transposed. Additionally, <span class="arithmatex">\(b_{ii}\)</span> and <span class="arithmatex">\(b_{hi}\)</span> will be implicitly broadcasted to be able to be summed with the tensor multiplication results. Then, the unwrapped and transposed shapes involved in the operations are</p>
<div class="arithmatex">\[
\begin{align}
i &amp;= \sigma\left(\left(H_{out}, H_{in}\right)\times\left(H_{in}, N\right)+\left(H_{out}, N\right)+\left(H_{out}, H_{out}\right)\times\left(H_{out}, N\right)+\left(H_{out}, N\right)\right)
\end{align}
\]</div>
<p>This will result in a tensor of shape <span class="arithmatex">\(\left(H_{out}, N\right)\)</span>. To estimate the complexity of this operation, it is possible to reuse the results from <a href="../linear/"><code>torch.nn.Linear</code></a> for both matrix multiplications and add the sigmoid operations <span class="arithmatex">\(\sigma\)</span>. <span class="arithmatex">\(i_{ops}\)</span> (the operations of the input gate <span class="arithmatex">\(i\)</span>) can be then broken down into four parts:</p>
<ol>
<li>The operations to needed compute <span class="arithmatex">\(W_{ii}x+b_{ii}\)</span>.</li>
<li>The operations needed to compute <span class="arithmatex">\(W_{hi}h+b_{hi}\)</span>.</li>
<li>The operations needed to sum both results.</li>
<li>The operations needed to compute the sigmoid function <span class="arithmatex">\(\sigma\)</span> of this result.</li>
</ol>
<p>For simplicity sake, the following definitions will be used:</p>
<div class="arithmatex">\[
\begin{align}
    i &amp;= \sigma\left(\underbrace{W_{ii}x^T+b_{ii}}_{i_0}+\underbrace{W_{hi}h^T+b_{hi}}_{i_1}\right)
\end{align}
\]</div>
<p>Then, in terms of operations (<span class="arithmatex">\(ops\)</span>) when <code>bias=True</code></p>
<div class="arithmatex">\[
\begin{align}
    i_{0_{ops}} &amp;=\left(W_{ii}x^T+b_{ii}\right)_{ops} = 2\times N\times H_{out}\times H_{in} \\
    i_{1_{ops}} &amp;=\left(W_{hi}x^T+b_{hi}\right)_{ops} = 2\times N\times H_{out}^2 \\
    \left(i_0+i_1\right)_{ops} &amp;= N\times H_{out} \\
    \sigma_{ops} &amp;= 3\times N\times H_{out} \\
    i_{ops} &amp;= 2\times N\times H_{out}\times\left(2+H_{in}+ H_{out}\right)
\end{align}
\]</div>
<p>and when <code>bias=False</code></p>
<div class="arithmatex">\[
\begin{align}
    i_{0_{ops}} &amp;=\left(W_{ii}x^T\right)_{ops} = N\times H_{out}\times \left(2\times H_{in}-1\right) \\
    i_{1_{ops}}
    &amp;=\left(W_{hi}x^T\right)_{ops}=N\times H_{out}\times\left(2\times H_{out}-1\right) \\
    \left(i_0+i_1\right)_{ops} &amp;= N\times H_{out} \\
    \sigma_{ops} &amp;= 3\times N\times H_{out}\\
    i_{ops} &amp;= 2\times N\times H_{out}\times\left(1+H_{in}+ H_{out}\right)
\end{align}
\]</div>
<h3 id="forget-and-output-gates">Forget and output gates</h3>
<p>Since the dimensions of these gates are the same as the input gate <span class="arithmatex">\(i\)</span>, it is trivial to observe that</p>
<div class="arithmatex">\[
\begin{equation}
    i_{ops}=f_{ops}=o_{ops}
\end{equation}
\]</div>
<h3 id="cell-gate">Cell gate</h3>
<p>The argument of the <span class="arithmatex">\(\text{tanh}\)</span> function has the same shape as the previously computed gates, yet the complexity of this function itself is the only difference between this gate and the others, then</p>
<div class="arithmatex">\[
\begin{align}
    g_{ops}&amp;=i_{0_{ops}}+i_{1_{ops}}+
    \left(i_0+i_1\right)_{ops}+\text{tanh}_{ops}\\
    \text{tanh}_{ops}&amp;=7\times N\times H_{out}\\
\end{align}
\]</div>
<p>Replacing by the previously calculated results</p>
<div class="arithmatex">\[
\begin{equation}
g_{ops}=\begin{cases}
    2\times N\times H_{out}\times \left(4+H_{in}+ H_{out}\right), &amp; \text{if}\ \text{bias}=\text{True} \\
    2\times N\times H_{out}\times \left(3+H_{in} + H_{out}\right), &amp;\text{if}\ \text{bias}=\text{False}
\end{cases}
\end{equation}
\]</div>
<h3 id="cprime"><span class="arithmatex">\(c\prime\)</span></h3>
<p>The complexity of <span class="arithmatex">\(c\prime\)</span> corresponds to three element-wise operations between elements with shape <span class="arithmatex">\(\left(H_{out}, N\right)\)</span>. Therefore its complexity is</p>
<div class="arithmatex">\[
\begin{align}
    c\prime &amp;= f\odot c+i\odot g\\
    c\prime_{ops} &amp;= 3\times N\times H_{out}
\end{align}
\]</div>
<h3 id="hprime"><span class="arithmatex">\(h\prime\)</span></h3>
<p>The complexity of <span class="arithmatex">\(h\prime\)</span> corresponds to one element-wise operation and a <span class="arithmatex">\(\text{tanh}\)</span> operation</p>
<div class="arithmatex">\[
\begin{align}
    h\prime &amp;= o \odot\text{tanh}\left(c\prime\right)\\
    \text{tanh}_{ops}&amp;=7\times N\times H_{out}\\
    h\prime_{ops} &amp;= 8\times N\times H_{out}
\end{align}
\]</div>
<h3 id="total-complexity">Total complexity</h3>
<p>Finally, the total complexity is the sum of all individual contributions</p>
<div class="arithmatex">\[
\begin{align}
    \text{LSTMCell}_{ops}=i_{ops}+f_{ops}+g_{ops}+o_{ops}+c\prime_{ops}+h\prime_{ops}
\end{align}
\]</div>
<p>In the case of <code>bias=True</code>, the total number of operations is</p>
<div class="arithmatex">\[
\begin{align}
    \text{LSTMCell}_{ops} &amp;= \underbrace{6 \times N \times H_{out}\times(2+H_{in} + H_{out})}_{i_{ops} + f_{ops} + o_{ops}} \nonumber \\
    &amp;\quad+ \underbrace{2 \times N \times H_{out} \times (4 + H_{in} + H_{out})}_{g_{ops}} \nonumber \\
    &amp;\quad+ \underbrace{11 \times N \times H_{\text{out}}}_{c\prime_{ops}+h\prime_{ops}} \\
    \text{LSTMCell}_{ops} &amp;= 8\times N\times H_{out}\times\left( H_{in}+H_{out}+3.875\right)
\end{align}
\]</div>
<p>and for <code>bias=False</code></p>
<div class="arithmatex">\[
\begin{align}
    \text{LSTMCell}_{ops} &amp;= \underbrace{6 \times N \times H_{out}\times(1+H_{in} + H_{out})}_{i_{ops} + f_{ops} + o_{ops}} \nonumber \\
    &amp;\quad+ \underbrace{2 \times N \times H_{out} \times (3 + H_{in} + H_{out})}_{g_{ops}} \nonumber \\
    &amp;\quad+ \underbrace{11 \times N \times H_{\text{out}}}_{c\prime_{ops}+h\prime_{ops}} \\
    \text{LSTMCell}_{ops} &amp;= 8\times N\times H_{out}\times\left(H_{in}+H_{out}+2.875\right)
\end{align}
\]</div>
<h2 id="summary">Summary</h2>
<p>The number of operations <span class="arithmatex">\(\phi\)</span> operformed by a <code>torch.nn.LSTMCell</code> module can be estimated as</p>
<div class="admonition success">
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">If <code>bias=True</code></label><label for="__tabbed_1_2">If <code>bias=False</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><span class="arithmatex">\(\text{LSTMCell}_{ops} = 8\times N\times H_{out}\times\left( H_{in}+H_{out}+3.875\right)\)</span></p>
</div>
<div class="tabbed-block">
<p><span class="arithmatex">\(\text{LSTMCell}_{ops} = 8\times N\times H_{out}\times\left(H_{in}+H_{out}+2.875\right)\)</span></p>
</div>
</div>
</div>
</div>
<p>Where</p>
<ul>
<li><span class="arithmatex">\(N\)</span> is the batch size.</li>
<li><span class="arithmatex">\(H_\text{in}\)</span> is the number of input features.</li>
<li><span class="arithmatex">\(H_\text{out}\)</span> is the number of output features.</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href="https://www.estebangomez.me" target="_blank">Esteban Gómez</a>, <a href="https://www.aalto.fi/en/department-of-information-and-communications-engineering/speech-interaction-technology" target="_blank">Speech Interaction Technology, Aalto University</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../js/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../js/tablesort.js"></script>
      
    
  </body>
</html>